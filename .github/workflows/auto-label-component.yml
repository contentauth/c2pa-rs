name: Auto-label by Component

on:
  issues:
    types: [opened]

jobs:
  label-component:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Label issue based on component
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const body = issue.body || '';
            
            // Map component names to labels
            const componentLabels = {
              'c2pa-rs': 'c2pa-rs',
              'c2patool': 'c2patool',
              'c2pa-c': 'c2pa-c'
            };
            
            // Extract component from issue body
            const componentMatch = body.match(/### Component\s*\n\s*(.+)/);
            
            if (componentMatch) {
              const component = componentMatch[1].trim();
              console.log(`Found component: ${component}`);
              
              // Check if component matches any of our known components
              for (const [key, label] of Object.entries(componentLabels)) {
                if (component.includes(key)) {
                  console.log(`Adding label: ${label}`);
                  await github.rest.issues.addLabels({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: issue.number,
                    labels: [label]
                  });
                  break;
                }
              }
            } else {
              console.log('Component not found in issue body');
            }

