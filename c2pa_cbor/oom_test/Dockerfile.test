FROM rustlang/rust:nightly-slim

WORKDIR /app

# Copy the minimal project structure needed
COPY Cargo.toml .
COPY src ./src
COPY oom_test ./oom_test

# Build in release mode
RUN cargo build --release --bin cbor-dos-test

# Make test script executable
RUN chmod +x oom_test/test_oom.sh

# Run the OOM test script by default
CMD ["./oom_test/test_oom.sh"]
